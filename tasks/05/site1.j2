hostname {{ variables.hostname }}

ip domain-name example.com
enable secret {{ variables.enable_secret }}
username {{ variables.username }} privilege 15 secret {{ variables.secret }}
crypto key generate rsa 2048
ip ssh version 2
line vty 0 4
 login local
 transport input ssh
 exit

{% for interface in variables.interfaces %}
interface {{ interface.name }}
 description {{ interface.description }}
 {% if interface.switchport %} 
 switchport mode trunk
 {% else %}
 switchport mode access
 {% endif %}
 ip address {{ interface.ip }} {{ interface.mask }}
 {% if interface.enabled %}
 no shutdown
 {% else %}
 shutdown
 {% endif %}
 speed {{ interface.speed }}
 duplex {{ interface.duplex }}
exit
{% endfor %}

router bgp {{ variables.bgp.as }}
{% if variables.bgp.router_id %}
 bgp router-id {{ variables.bgp.router_id }}
{% endif %}
{% for neighbor in variables.bgp.neighbors %}
 neighbor {{ neighbor.neighbor }} remote-as {{ neighbor.remote_as }}
  {% if neighbor.next_hop_self %}
 neighbor {{ neighbor.neighbor }} next-hop-self
  {% endif %}
  {% if neighbor.route_map_out %}
 neighbor {{ neighbor.neighbor }} route-map {{ neighbor.route_map_out }} out
  {% endif %}
  {% if neighbor.route_map_in %}
 neighbor {{ neighbor.neighbor }} route-map {{ neighbor.route_map_in }} in
  {% endif %}
{% endfor %}

end
write memory